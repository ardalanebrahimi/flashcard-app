<div class="flashcard-container">
  <!-- Session Progress Header -->
  <div class="session-header" *ngIf="sessionProgress && !sessionComplete">
    <div class="session-progress">
      <div class="progress-info">
        <span class="card-counter">{{ currentCardNumber }} / {{ totalCards }}</span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercentage"></div>
        </div>
      </div>
      <button class="end-session-btn" (click)="onEndSession()">End Session</button>
    </div>
    
    <!-- Session Statistics -->
    <div class="session-stats">
      <div class="stat-item correct">
        <span class="stat-icon">‚úÖ</span>
        <span class="stat-count">{{ sessionCorrectCount }}</span>
      </div>
      <div class="stat-item incorrect">
        <span class="stat-icon">‚ùå</span>
        <span class="stat-count">{{ sessionIncorrectCount }}</span>
      </div>
      <div class="stat-item practice">
        <span class="stat-icon">üîÑ</span>
        <span class="stat-count">{{ sessionPracticeAgainCount }}</span>
      </div>
      <div class="stat-item success" *ngIf="sessionCorrectCount + sessionIncorrectCount > 0">
        <span class="stat-label">{{ sessionSuccessRate }}%</span>
      </div>
    </div>
  </div>

  <!-- Session Completion Screen -->
  <div class="session-complete" *ngIf="sessionComplete && sessionProgress">
    <div class="completion-icon">üéâ</div>
    <h2>Session Complete!</h2>
    
    <div class="session-summary">
      <h3>Session Summary</h3>
      <div class="summary-stats">
        <div class="summary-row">
          <span class="summary-label">Cards Studied:</span>
          <span class="summary-value">{{ sessionProgress.totalCards }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Correct:</span>
          <span class="summary-value correct">{{ sessionProgress.correctCount }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Incorrect:</span>
          <span class="summary-value incorrect">{{ sessionProgress.incorrectCount }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Practice Again:</span>
          <span class="summary-value practice">{{ sessionProgress.practiceAgainCount }}</span>
        </div>
        <div class="summary-row">
          <span class="summary-label">Success Rate:</span>
          <span class="summary-value success">{{ sessionSuccessRate }}%</span>
        </div>
      </div>
    </div>

    <div class="completion-actions">
      <button class="primary-btn" (click)="onStartNewSession()">
        <span class="btn-icon">üéØ</span>
        <span class="btn-text">Start New Session</span>
      </button>
      <button class="secondary-btn" (click)="onReturnHome()">
        <span class="btn-icon">üè†</span>
        <span class="btn-text">Return Home</span>
      </button>
    </div>
  </div>

  <!-- Main flashcard area -->
  <div class="flashcard" *ngIf="currentWord && !sessionComplete">
    <!-- German word display -->
    <div class="word-container">
      <div class="german-word">{{ currentWord.word }}</div>
      
      <!-- Progress indicators -->
      <div class="word-progress" *ngIf="isCurrentWordKnown || isCurrentWordUnknown || isCurrentWordForPracticeAgain || currentWordScore > 0">
        <div class="progress-indicator known" *ngIf="isCurrentWordKnown">
          ‚úÖ Previously marked as known
        </div>
        <div class="progress-indicator unknown" *ngIf="isCurrentWordUnknown">
          ‚ùå Previously marked as unknown
        </div>
        <div class="progress-indicator practice" *ngIf="isCurrentWordForPracticeAgain">
          üîÑ Previously marked for practice
        </div>
        <div class="progress-indicator score" *ngIf="currentWord && currentWord.lastResults && currentWord.lastResults.length > 0">
          <span class="score-text">üéØ Score:</span>
          <div class="score-indicator">
            <!-- Display actual results -->
            <div
              *ngFor="let result of currentWord.lastResults; let i = index"
              [ngStyle]="{
                'background-color': result === 'correct' ? '#4CAF50' : 
                                    result === 'wrong' ? '#f44336' : '#ccc',
                'width': '12px',
                'height': '12px',
                'margin': '2px',
                'border-radius': '3px',
                'display': 'inline-block',
                'border': '1px solid rgba(0, 0, 0, 0.2)'
              }"
            ></div>
            <!-- Fill remaining with gray if less than 3 entries -->
            <div
              *ngFor="let i of getRemainingSlots(currentWord.lastResults || [])"
              style="background-color: #ccc; width: 12px; height: 12px; margin: 2px; border-radius: 3px; display: inline-block; border: 1px solid rgba(0, 0, 0, 0.2);"
            ></div>
          </div>
          <span class="score-fraction">({{ currentWordScore }}/3)</span>
        </div>
      </div>
    </div>

    <!-- Show meaning button (only visible when meaning is hidden) -->
    <div class="meaning-section">
      <button 
        *ngIf="!showMeaning" 
        class="show-meaning-btn"
        (click)="onShowMeaning()">
        Show Meaning
      </button>

      <!-- Translation display (only visible when meaning is shown) -->
      <div *ngIf="showMeaning" class="translation">
        <div class="translation-label">English:</div>
        <div class="translation-text">
          {{ currentWord.translation }}
        </div>
      </div>
    </div>

    <!-- Bookmark section (separate from main actions) -->
    <div *ngIf="showMeaning" class="bookmark-section">
      <button class="bookmark-btn" 
              [class.bookmarked]="currentWord.bookmarked"
              (click)="onToggleBookmark()"
              title="{{ currentWord.bookmarked ? 'Remove bookmark' : 'Add bookmark' }}">
        <span class="btn-icon">{{ currentWord.bookmarked ? '‚≠ê' : '‚òÜ' }}</span>
        <span class="btn-text">{{ currentWord.bookmarked ? 'Bookmarked' : 'Bookmark' }}</span>
      </button>
    </div>

    <!-- Action buttons (only visible when meaning is shown) -->
    <div *ngIf="showMeaning" class="action-buttons">
      <button class="action-btn know-btn" (click)="onKnowIt()">
        <span class="btn-icon">‚úÖ</span>
        <span class="btn-text">I know it</span>
      </button>
      
      <button class="action-btn dont-know-btn" (click)="onDontKnowIt()">
        <span class="btn-icon">‚ùå</span>
        <span class="btn-text">I don't know it</span>
      </button>
    </div>
  </div>

  <!-- Loading state -->
  <div *ngIf="!currentWord && !sessionComplete" class="loading">
    <div class="loading-text">Starting session...</div>
  </div>

  <!-- Overall Progress (bottom section for reference) -->
  <div class="overall-progress" *ngIf="!sessionComplete && (overallKnownCount > 0 || overallUnknownCount > 0)">
    <h4>Overall Progress</h4>
    <div class="overall-stats">
      <div class="overall-stat">
        <span class="stat-label">Known:</span>
        <span class="stat-value known">{{ overallKnownCount }}</span>
      </div>
      <div class="overall-stat">
        <span class="stat-label">Unknown:</span>
        <span class="stat-value unknown">{{ overallUnknownCount }}</span>
      </div>
      <div class="overall-stat">
        <span class="stat-label">Practice:</span>
        <span class="stat-value practice">{{ overallPracticeAgainCount }}</span>
      </div>
      <div class="overall-stat">
        <span class="stat-label">Success:</span>
        <span class="stat-value success">{{ overallSuccessRate }}%</span>
      </div>
    </div>
  </div>
</div>
