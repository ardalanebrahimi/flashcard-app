<div class="words-list-container">
  <!-- Header -->
  <header class="header">
    <button class="back-button" (click)="goBack()" aria-label="Go back">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="m15 18-6-6 6-6"/>
      </svg>
    </button>
    <h1 class="title">Words Progress</h1>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading && isInitializing" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading word progress...</p>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading || !isInitializing" class="content">
    <!-- Statistics Cards - Compact -->
    <div class="stats-compact">
      <div class="stat-compact-card" title="Total Words">
        <svg class="stat-icon-svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <span class="stat-value">{{ statistics.totalWords }}</span>
        <span class="stat-label">Words</span>
      </div>
      <div class="stat-compact-card" title="New Words">
        <svg class="stat-icon-svg new-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2"/>
        </svg>
        <span class="stat-value">{{ statistics.newWords }}</span>
        <span class="stat-label">New</span>
      </div>
      <div class="stat-compact-card" title="Learning Words">
        <svg class="stat-icon-svg learning-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2L2 7l10 5 10-5-10-5z"/>
          <path d="m2 17 10 5 10-5"/>
          <path d="m2 12 10 5 10-5"/>
        </svg>
        <span class="stat-value">{{ statistics.learningWords }}</span>
        <span class="stat-label">Learning</span>
      </div>
      <div class="stat-compact-card" title="Mastered Words">
        <svg class="stat-icon-svg mastered-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4"/>
          <circle cx="12" cy="12" r="10"/>
        </svg>
        <span class="stat-value">{{ statistics.masteredWords }}</span>
        <span class="stat-label">Mastered</span>
      </div>
      <div class="stat-compact-card" title="Overall Accuracy">
        <svg class="stat-icon-svg accuracy-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="stat-value">{{ statistics.overallAccuracy }}%</span>
        <span class="stat-label">Accuracy</span>
      </div>
      <div class="stat-compact-card" title="Total Practices">
        <svg class="stat-icon-svg practice-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
        </svg>
        <span class="stat-value">{{ statistics.totalPractices }}</span>
        <span class="stat-label">Practice</span>
      </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filters-header" (click)="toggleFilters()">
        <span class="filters-title">
          <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 3H2l8 9.46V19l4 2v-8.54L22 3z"/>
          </svg>
          Filters & Search
        </span>
        <svg 
          class="expand-icon" 
          [class.expanded]="!isFiltersCollapsed"
          width="18" 
          height="18" 
          viewBox="0 0 24 24" 
          fill="none" 
          stroke="currentColor" 
          stroke-width="2"
        >
          <path d="M6 9l6 6 6-6"/>
        </svg>
      </div>

      <div class="filters-content" [class.collapsed]="isFiltersCollapsed">
        <div class="search-container">
          <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="m21 21-4.35-4.35"/>
          </svg>
          <input 
            type="text" 
            class="search-input"
            placeholder="Search words or translations..."
            [value]="filters.searchTerm"
            (input)="onSearchChange($any($event.target).value || '')"
          >
        </div>

        <div class="filter-row">
          <div class="filter-group">
            <label class="filter-label">Status:</label>
            <select 
              class="filter-select"
              [value]="filters.status"
              (change)="onStatusFilterChange($any($event.target).value)"
            >
              <option value="all">All Status</option>
              <option value="new">New</option>
              <option value="learning">Learning</option>
              <option value="mastered">Mastered</option>
            </select>
          </div>

          <div class="filter-group">
            <label class="filter-label">Source:</label>
            <select 
              class="filter-select"
              [value]="filters.source"
              (change)="onSourceFilterChange($any($event.target).value)"
            >
              <option value="all">All Sources</option>
              <option value="dictionary">Dictionary</option>
              <option value="custom">Custom</option>
            </select>
          </div>

          <button class="clear-filters-btn" (click)="clearFilters()">
            Clear Filters
          </button>
        </div>
      </div>
    </div>

    <!-- Sort Controls - Compact -->
    <div class="sort-controls-compact">
      <div class="sort-group">
        <label class="sort-label">
          <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M7 12h10m-7 6h4"/>
          </svg>
          Sort:
        </label>
        <select 
          class="sort-select"
          [value]="filters.sortBy"
          (change)="onSortChange($any($event.target).value)"
        >
          <option value="alphabetical">A-Z</option>
          <option value="lastStudied">Last Studied</option>
          <option value="practiceCount">Practice Count</option>
          <option value="accuracy">Accuracy</option>
          <option value="score">Quiz Score</option>
          <option value="dateAdded">Date Added</option>
        </select>
      </div>
      <button 
        class="sort-direction-btn"
        (click)="toggleSortDirection()"
        [title]="'Sort ' + (filters.sortDirection === 'asc' ? 'ascending' : 'descending')"
      >
        {{ filters.sortDirection === 'asc' ? '↑' : '↓' }}
      </button>
    </div>
 
    <!-- Results Info -->
    <div class="results-info">
      <span>{{ filteredWords.length }} words found</span>
      <span *ngIf="filteredWords.length !== statistics.totalWords">
        (filtered from {{ statistics.totalWords }} total)
      </span>
    </div>

    <!-- Words List -->
    <div class="words-list">
      <div 
        *ngFor="let word of paginatedWords; trackBy: trackByWord"
        class="word-item"
      >
        <div class="word-header">
          <div class="word-info">
            <h3 class="word-german">{{ word.word }}</h3>
            <p class="word-translation">{{ word.translation }}</p>
          </div>
          <div class="word-meta">
            <div class="word-badges">
              <span [class]="getStatusBadgeClass(word.status)" class="badge-compact">
                <svg *ngIf="word.status === 'new'" class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 6v6l4 2"/>
                </svg>
                <svg *ngIf="word.status === 'learning'" class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                  <path d="m2 17 10 5 10-5"/>
                  <path d="m2 12 10 5 10-5"/>
                </svg>
                <svg *ngIf="word.status === 'mastered'" class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M9 12l2 2 4-4"/>
                  <circle cx="12" cy="12" r="10"/>
                </svg>
                <span class="badge-text">{{ word.status | titlecase }}</span>
              </span>
              <span [class]="getSourceBadgeClass(word.source)" class="badge-compact">
                <svg *ngIf="word.source === 'dictionary'" class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                <svg *ngIf="word.source === 'custom'" class="badge-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                  <polyline points="10,9 9,9 8,9"/>
                </svg>
                <span class="badge-text">{{ word.source | titlecase }}</span>
              </span>
            </div>
            <button 
              class="reset-btn-compact"
              (click)="resetWordProgress(word)"
              title="Reset progress for this word"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
                <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                <path d="M3 21v-5h5"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="word-stats-compact">
          <span class="stat-compact" title="Total practice attempts">
            <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01"/>
            </svg>
            <span class="stat-text">{{ word.practiceCount }} attempts</span>
          </span>
          <span class="stat-compact correct" title="Correct answers">
            <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <circle cx="12" cy="12" r="10"/>
            </svg>
            <span class="stat-text">{{ word.correctCount }} correct</span>
          </span>
          <span class="stat-compact wrong" title="Wrong answers">
            <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M15 9l-6 6"/>
              <path d="M9 9l6 6"/>
            </svg>
            <span class="stat-text">{{ word.wrongCount }} wrong</span>
          </span>
          <span class="stat-compact accuracy" title="Success rate percentage">
            <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span class="stat-text">{{ getAccuracy(word) }}% success</span>
          </span>
          <span class="stat-compact score-visual" title="Recent quiz performance (last 3 attempts): {{ getWordScore(word) }}/3">
            <span class="score-label">
              <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <circle cx="12" cy="12" r="10"/>
              </svg>
              Recent:
            </span>
            <div class="score-indicator">
              <!-- Display actual results -->
              <div
                *ngFor="let result of getWordLastResults(word); let i = index"
                [ngStyle]="{
                  'background-color': result === 'correct' ? '#22c55e' : 
                                      result === 'wrong' ? '#ef4444' : '#d1d5db',
                  'width': '10px',
                  'height': '10px',
                  'margin': '1px',
                  'border-radius': '50%',
                  'display': 'inline-block',
                  'border': '1px solid rgba(0,0,0,0.1)'
                }"
                [title]="result === 'correct' ? 'Correct answer' : 'Wrong answer'"
              ></div>
              <!-- Fill remaining with gray if less than 3 entries -->
              <div
                *ngFor="let i of getRemainingSlots(getWordLastResults(word))"
                style="background-color: #e5e7eb; width: 10px; height: 10px; margin: 1px; border-radius: 50%; display: inline-block; border: 1px solid rgba(0,0,0,0.1);"
                title="No attempt yet"
              ></div>
            </div>
          </span>
          <span class="stat-compact" *ngIf="word.masteredDate" title="Date when word was mastered">
            <svg class="stat-icon-mini" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
            <span class="stat-text">Mastered {{ formatDate(word.masteredDate) }}</span>
          </span>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="filteredWords.length === 0 && !isLoading" class="empty-state">
        <div class="empty-icon">📚</div>
        <h3>No words found</h3>
        <p>Try adjusting your filters or search term.</p>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="totalPages > 1" class="pagination">
      <button 
        class="pagination-button"
        [disabled]="currentPage === 1"
        (click)="changePage(currentPage - 1)"
      >
        Previous
      </button>

      <button 
        *ngFor="let page of pageNumbers"
        class="pagination-button"
        [class.active]="page === currentPage"
        (click)="changePage(page)"
      >
        {{ page }}
      </button>

      <button 
        class="pagination-button"
        [disabled]="currentPage === totalPages"
        (click)="changePage(currentPage + 1)"
      >
        Next
      </button>
    </div>
  </div>
</div>
